# Kururi AI CLI

[![DeepWiki](https://img.shields.io/badge/DeepWiki-kandotrun%2Fkururi--ai-blue.svg?logo=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAAyCAYAAAAnWDnqAAAAAXNSR0IArs4c6QAAA05JREFUaEPtmUtyEzEQhtWTQyQLHNak2AB7ZnyXZMEjXMGeK/AIi+QuHrMnbChYY7MIh8g01fJoopFb0uhhEqqcbWTp06/uv1saEDv4O3n3dV60RfP947Mm9/SQc0ICFQgzfc4CYZoTPAswgSJCCUJUnAAoRHOAUOcATwbmVLWdGoH//PB8mnKqScAhsD0kYP3j/Yt5LPQe2KvcXmGvRHcDnpxfL2zOYJ1mFwrryWTz0advv1Ut4CJgf5uhDuDj5eUcAUoahrdY/56ebRWeraTjMt/00Sh3UDtjgHtQNHwcRGOC98BJEAEymycmYcWwOprTgcB6VZ5JK5TAJ+fXGLBm3FDAmn6oPPjR4rKCAoJCal2eAiQp2x0vxTPB3ALO2CRkwmDy5WohzBDwSEFKRwPbknEggCPB/imwrycgxX2NzoMCHhPkDwqYMr9tRcP5qNrMZHkVnOjRMWwLCcr8ohBVb1OMjxLwGCvjTikrsBOiA6fNyCrm8V1rP93iVPpwaE+gO0SsWmPiXB+jikdf6SizrT5qKasx5j8ABbHpFTx+vFXp9EnYQmLx02h1QTTrl6eDqxLnGjporxl3NL3agEvXdT0WmEost648sQOYAeJS9Q7bfUVoMGnjo4AZdUMQku50McDcMWcBPvr0SzbTAFDfvJqwLzgxwATnCgnp4wDl6Aa+Ax283gghmj+vj7feE2KBBRMW3FzOpLOADl0Isb5587h/U4gGvkt5v60Z1VLG8BhYjbzRwyQZemwAd6cCR5/XFWLYZRIMpX39AR0tjaGGiGzLVyhse5C9RKC6ai42ppWPKiBagOvaYk8lO7DajerabOZP46Lby5wKjw1HCRx7p9sVMOWGzb/vA1hwiWc6jm3MvQDTogQkiqIhJV0nBQBTU+3okKCFDy9WwferkHjtxib7t3xIUQtHxnIwtx4mpg26/HfwVNVDb4oI9RHmx5WGelRVlrtiw43zboCLaxv46AZeB3IlTkwouebTr1y2NjSpHz68WNFjHvupy3q8TFn3Hos2IAk4Ju5dCo8B3wP7VPr/FGaKiG+T+v+TQqIrOqMTL1VdWV1DdmcbO8KXBz6esmYWYKPwDL5b5FA1a0hwapHiom0r/cKaoqr+27/XcrS5UwSMbQAAAABJRU5ErkJggg==)](https://deepwiki.com/kandotrun/kururi-ai)
<!-- DeepWiki badge generated by https://deepwiki.ryoppippi.com/ -->

Image rotation classifier with a ViT model. The CLI runs on CPU, CUDA, or Apple MPS, auto-downloads the checkpoint from
a GitHub Release, and supports single-file or recursive directory processing.

## Features

- Auto checkpoint download on first run (URL/sha256 configurable via args or env).
- Single image prediction or recursive directory batch processing.
- Optional saving of rotation-corrected images.
- Pure-Python CLI (no comments, typed, minimal dependencies).

## Requirements

- Python 3.12.9
- PyTorch, TorchVision, timm, Pillow (installed via `uv pip install -e cli`)

## Setup

```bash
git clone https://github.com/kandotrun/kururi-ai.git
cd kururi-ai
uv venv .venv
source .venv/bin/activate
uv pip install -e cli
```

## Model download

- If `models/kururi-orient-v1.pth` is missing, the CLI downloads it from the configured URL.
- Set URL and hash via args or environment variables:

```bash
export KURURI_MODEL_URL="https://github.com/<owner>/<repo>/releases/download/v0.1.0/kururi-orient-v1.pth"
export KURURI_MODEL_SHA256="<sha256sum>"
# optional
export KURURI_MODEL_TIMEOUT=1800
```

- Default URL is a placeholder: `https://github.com/OWNER/REPO/releases/download/v0.1.0/kururi-orient-v1.pth`. Replace
  it after publishing your Release.

## Usage

Single image:

```bash
uv run python cli/main.py predict \
  --image /path/to/image.jpg \
  --device cpu \
  --model-name vit_large_patch16_224 \
  --save-rotated /path/to/fixed.jpg
```

Recursive directory:

```bash
uv run python cli/main.py predict \
  --dir /path/to/images \
  --save-rotated-dir outputs \
  --device cpu \
  --model-name vit_large_patch16_224
```

Supported extensions: jpg, jpeg, png, bmp, tif, tiff, webp.

Try with bundled samples (recursive):

```bash
uv run python cli/main.py predict \
  --dir samples \
  --save-rotated-dir samples_out \
  --device cpu
```

Sample inputs and corrected outputs (thumbnails):

| # | Input                                                            | Corrected output                                                      |
|---|------------------------------------------------------------------|-----------------------------------------------------------------------|
| 1 | <img src="samples/sample1.webp" width="180" alt="sample1 input"> | <img src="samples/out/sample1.webp" width="180" alt="sample1 output"> |
| 2 | <img src="samples/sample2.webp" width="180" alt="sample2 input"> | <img src="samples/out/sample2.webp" width="180" alt="sample2 output"> |
| 3 | <img src="samples/sample3.webp" width="180" alt="sample3 input"> | <img src="samples/out/sample3.webp" width="180" alt="sample3 output"> |
| 4 | <img src="samples/sample4.webp" width="180" alt="sample4 input"> | <img src="samples/out/sample4.webp" width="180" alt="sample4 output"> |
| 5 | <img src="samples/sample5.jpg" width="180" alt="sample5 input">  | <img src="samples/out/sample5.jpg" width="180" alt="sample5 output">  |

### Checkpoint options

- `--checkpoint` path (default `models/kururi-orient-v1.pth`)
- `--checkpoint-url` override download URL
- `--checkpoint-sha256` integrity check
- `--download-timeout` seconds (default 1800 or `KURURI_MODEL_TIMEOUT`)

## Publish the model to GitHub Release

1. Compute hash: `shasum -a 256 models/kururi-orient-v1.pth`
2. Create a Release and upload `kururi-orient-v1.pth` as an asset.
3. Update README, env examples, and default URL in code/CI with the Release URL and sha256.

## License

- Code and packaged model are released under the MIT License. See `LICENSE`.
- Original model by Yuki Arano (新野ユキ)
    - Twitter: https://x.com/yuki_arano
    - GitHub: https://github.com/ObuchiYuki
    - Original post: https://x.com/yuki_arano/status/1788051297108902073
    - iOS
      app: https://apps.apple.com/jp/app/ai%E3%81%8C%E5%86%99%E7%9C%9F%E3%81%AE%E5%90%91%E3%81%8D%E3%82%92%E4%BF%AE%E6%AD%A3-%E3%81%8F%E3%82%8B%E3%82%8Aai/id6480589907

## Japanese documentation

See `README.ja.md` for the Japanese version.
